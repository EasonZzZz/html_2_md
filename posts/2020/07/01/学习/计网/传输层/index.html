<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>传输层 | Nice To Meet U</title><meta name="description" content="传输层"><meta name="keywords" content="计网"><meta name="author" content="EasonZzZz"><meta name="copyright" content="EasonZzZz"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="传输层"><meta name="twitter:description" content="传输层"><meta name="twitter:image" content="https://source.unsplash.com/collection/collectionid/1600x900"><meta property="og:type" content="article"><meta property="og:title" content="传输层"><meta property="og:url" content="http://yoursite.com/2020/07/01/学习/计网/传输层/"><meta property="og:site_name" content="Nice To Meet U"><meta property="og:description" content="传输层"><meta property="og:image" content="https://source.unsplash.com/collection/collectionid/1600x900"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="http://yoursite.com/2020/07/01/学习/计网/传输层/"><link rel="prev" title="HTML基础" href="http://yoursite.com/2020/07/11/学习/Web/前端/HTML基础/"><link rel="next" title="应用层" href="http://yoursite.com/2020/07/01/学习/计网/应用层/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://easonzzzz.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Nice To Meet U</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 目录</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://raw.githubusercontent.com/EasonZzZz/BlogPic/master/img/20191025120143.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">106</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">41</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">10</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 目录</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#概述"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text"> 概述</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#两个协议"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text"> 两个协议</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#寻址与端口"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text"> 寻址与端口</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#udp-协议"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text"> UDP 协议</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#udp-首部格式"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text"> UDP 首部格式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#udp-校验"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text"> UDP 校验</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#发送端"><span class="toc_mobile_items-number">2.2.1.</span> <span class="toc_mobile_items-text"> 发送端</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#接收端"><span class="toc_mobile_items-number">2.2.2.</span> <span class="toc_mobile_items-text"> 接收端</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#tcp-协议"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text"> TCP 协议</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#tcp-首部格式"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text"> TCP 首部格式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#tcp-连接管理"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text"> TCP 连接管理</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#连接建立-三次握手"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text"> 连接建立 (三次握手)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#syn-洪泛攻击"><span class="toc_mobile_items-number">3.2.1.1.</span> <span class="toc_mobile_items-text"> SYN 洪泛攻击</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#连接释放-四次握手"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text"> 连接释放 (四次握手)</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#tcp-可靠传输"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text"> TCP 可靠传输</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#tcp-流量控制"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text"> TCP 流量控制</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#tcp-拥塞控制"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text"> TCP 拥塞控制</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#慢开始和拥塞避免"><span class="toc_mobile_items-number">3.5.1.</span> <span class="toc_mobile_items-text"> 慢开始和拥塞避免</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#快重传和快恢复"><span class="toc_mobile_items-number">3.5.2.</span> <span class="toc_mobile_items-text"> 快重传和快恢复</span></a></li></ol></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#概述"><span class="toc-number">1.</span> <span class="toc-text"> 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#两个协议"><span class="toc-number">1.1.</span> <span class="toc-text"> 两个协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#寻址与端口"><span class="toc-number">1.2.</span> <span class="toc-text"> 寻址与端口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#udp-协议"><span class="toc-number">2.</span> <span class="toc-text"> UDP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#udp-首部格式"><span class="toc-number">2.1.</span> <span class="toc-text"> UDP 首部格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#udp-校验"><span class="toc-number">2.2.</span> <span class="toc-text"> UDP 校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#发送端"><span class="toc-number">2.2.1.</span> <span class="toc-text"> 发送端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接收端"><span class="toc-number">2.2.2.</span> <span class="toc-text"> 接收端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tcp-协议"><span class="toc-number">3.</span> <span class="toc-text"> TCP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp-首部格式"><span class="toc-number">3.1.</span> <span class="toc-text"> TCP 首部格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp-连接管理"><span class="toc-number">3.2.</span> <span class="toc-text"> TCP 连接管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#连接建立-三次握手"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 连接建立 (三次握手)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#syn-洪泛攻击"><span class="toc-number">3.2.1.1.</span> <span class="toc-text"> SYN 洪泛攻击</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接释放-四次握手"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 连接释放 (四次握手)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp-可靠传输"><span class="toc-number">3.3.</span> <span class="toc-text"> TCP 可靠传输</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp-流量控制"><span class="toc-number">3.4.</span> <span class="toc-text"> TCP 流量控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp-拥塞控制"><span class="toc-number">3.5.</span> <span class="toc-text"> TCP 拥塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#慢开始和拥塞避免"><span class="toc-number">3.5.1.</span> <span class="toc-text"> 慢开始和拥塞避免</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#快重传和快恢复"><span class="toc-number">3.5.2.</span> <span class="toc-text"> 快重传和快恢复</span></a></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://source.unsplash.com/collection/collectionid/1600x900)"><div id="post-info"><div id="post-title"><div class="posttitle">传输层</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-07-01<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-07-22</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/计算机网络/">计算机网络</a></span><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="概述"><a class="markdownIt-Anchor" href="#概述"></a> 概述</h1>
<p>只有主机才有的层次</p>
<p>传输层功能：</p>
<ol>
<li><strong>提供进程和进程之间的逻辑通信</strong>
<ul>
<li>网络层提供主机间的逻辑通信</li>
</ul>
</li>
<li><strong>复用和分用</strong>
<ul>
<li>复用：应用层所有的应用进程都可以通过传输层再传输到网络层</li>
<li>分用：传输层从网络层收到数据后交付指明的应用进程</li>
</ul>
</li>
<li><strong>对收到的报文进行差错检测</strong></li>
</ol>
<h2 id="两个协议"><a class="markdownIt-Anchor" href="#两个协议"></a> 两个协议</h2>
<p>TCP：面向连接的传输控制协议</p>
<ul>
<li>可靠，面向连接，时延大，适用于大文件</li>
</ul>
<p>UDP：无连接的用户数据报协议</p>
<ul>
<li>不可靠，无连接，时延小，适用于小文件</li>
</ul>
<h2 id="寻址与端口"><a class="markdownIt-Anchor" href="#寻址与端口"></a> 寻址与端口</h2>
<p><strong>端口</strong>：传输层的SAP，<strong>标识主机中的应用进程</strong><br>
端口号 <strong>只有本地意义</strong>，在因特网中无意义。<br>
端口号长度为 <strong>16 bit</strong>，能表示 65536 个不同端口号</p>
<ul>
<li>按范围分为：服务端、客户端<br>
<img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200427174355.png" class="lazyload"><br>
<img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200427174440.png" class="lazyload"></li>
<li><strong>套接字 Socket = (主机IP地址，端口号)</strong>
<ul>
<li>唯一标识网络上的一个主机它上面的一个进程（端点）</li>
</ul>
</li>
</ul>
<h1 id="udp-协议"><a class="markdownIt-Anchor" href="#udp-协议"></a> UDP 协议</h1>
<p>UDP 只在 IP 数据报服务上增加了很少功能：复用分用和差错检测功能。<br>
UDP 主要特点：</p>
<ol>
<li>UDP 是 <strong>无连接</strong> 的，减少开销和发送数据之前的时延</li>
<li>UDP 使用最大努力交付，即 <strong>不保证可靠交付</strong></li>
<li>UDP 是 <strong>面向报文</strong> 的，适合 <strong>一次性</strong> 传输少量数据的网络应用</li>
<li>UDP <strong>无拥塞控制</strong>，适 合很多实时应用</li>
<li>UDP <strong>首部开销小</strong>，<strong>8B</strong>，而 TCP 20B</li>
</ol>
<h2 id="udp-首部格式"><a class="markdownIt-Anchor" href="#udp-首部格式"></a> UDP 首部格式</h2>
<p><img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200427192235.png" class="lazyload"></p>
<ul>
<li>分用时，找不到对应的端口号时，丢弃，然后发送 ICMP “端口不可达”差错报告报文</li>
</ul>
<h2 id="udp-校验"><a class="markdownIt-Anchor" href="#udp-校验"></a> UDP 校验</h2>
<p><img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200427192742.png" class="lazyload"></p>
<p>伪首部只有在计算校验和时才出现，不向下传送也不向上递交</p>
<p>17：封装 UDP 报文的 IP 数据报首部协议字段是 17</p>
<p>UDP 长度：UDP 首部 8B + 数据部分长度（不包括伪首部)</p>
<h3 id="发送端"><a class="markdownIt-Anchor" href="#发送端"></a> 发送端</h3>
<ol>
<li>填上伪首部</li>
<li>全 0 填充校验和字段</li>
<li>全 0 填充数据部分（UDP数据报要看成许多 4B 的字串接起来）</li>
<li>伪首部 + 首部 + 数据部分采用二进制反码求和</li>
<li>把和求反码填入校验和字段</li>
<li>去掉伪首部，发送</li>
</ol>
<h3 id="接收端"><a class="markdownIt-Anchor" href="#接收端"></a> 接收端</h3>
<ol>
<li>填上伪首部</li>
<li>伪首部 + 首部 + 数据部分采用二进制反码求和</li>
<li>结果全为 1 则无差错，否则丢弃数据报/交给应用层附上差错警告</li>
</ol>
<h1 id="tcp-协议"><a class="markdownIt-Anchor" href="#tcp-协议"></a> TCP 协议</h1>
<p>TCP 的特点：</p>
<ol>
<li>TCP 是 <strong>面向连接（虚连接）</strong> 的传输层协议</li>
<li>每一条 <strong>TCP 连接只能由两个端点</strong>，每一条 TCP 连接只能是 <strong>点对点</strong> 的</li>
<li>TCP 提供 <strong>可靠交付</strong> 的服务，无差错、不丢失、不重复、按序到达</li>
<li>TCP 提供 <strong>全双工</strong> 通信（发送缓存、接收缓存）</li>
<li>TCP 是面向字节流的 =&gt; TCP 把应用程序交下来的数据看成仅仅是一连串的 <strong>无结构的字节流</strong></li>
</ol>
<h2 id="tcp-首部格式"><a class="markdownIt-Anchor" href="#tcp-首部格式"></a> TCP 首部格式</h2>
<p><img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200427194450.png" class="lazyload"></p>
<ul>
<li><strong>序号</strong>：表示本报文段所发送数据的 <strong>第一个字节的序号</strong></li>
<li><strong>确认号</strong>：<strong>期望</strong> 收到对方下一个报文段的第一个数据直接的序号
<ul>
<li>确认号为 N，则代表前 N-1 都已经正确接收了</li>
</ul>
</li>
<li><strong>数据偏移（首部长度）</strong>：TCP 报文段的数据起始处距离 TCP 报文段的起始处有多远
<ul>
<li>以 <strong>4B</strong> 为单位</li>
</ul>
</li>
<li>保留字段：占6位，目前全0</li>
<li>6 个控制位
<ul>
<li><em><strong>紧急位 URG</strong></em>：URG=1时，标明此报文段中有紧急数据，是高优先级的数据，是高优先级的数据，发送方尽快发送，配合 <strong>紧急指针字段</strong> 使用</li>
<li><em><strong>确认位 ACK</strong></em>：ACK=1时，确认号有效，在连接建立后，所有传送的报文段都必须把ACK置1</li>
<li><strong>推送位 PSH</strong>：PSH=1时，接收方尽快接收</li>
<li><strong>复位 RST</strong>：RST=1时，表示TCP连接中出现严重差错，必须释放连接，然后再重新建立</li>
<li><em><strong>同步位 SYN</strong></em>：SYN=1时，表明是一个连接请求/连接接受报文</li>
<li><em><strong>终止位 FIN</strong></em>：FIN=1时，表示此报文段发送方数据已发完，要求释放连接</li>
</ul>
</li>
<li><strong>窗口</strong>：指的是发送本报文段的一方的接收窗口，以让对方确认发送窗口的大小</li>
<li><strong>校验和</strong>：检验首部+数据，校验时要加上12B伪首部（协议字段为4）</li>
<li><strong>紧急指针</strong>：URG=1时才有意义，指出本报文段中紧急数据的字节数（从数据段的第一字节开始）</li>
<li><strong>选项</strong>：最大报文段长度MSS（TCP报文段中数据段的最大长度）</li>
</ul>
<h2 id="tcp-连接管理"><a class="markdownIt-Anchor" href="#tcp-连接管理"></a> TCP 连接管理</h2>
<p>TCP 连接传输三个阶段：连接建立 -&gt; 数据传输 -&gt; 连接释放</p>
<ul>
<li>连接的建立采用 <strong>客户服务器方式（三次握手）</strong>，主动发起连接建立的应用进程叫做客户，而被动等待连接建立的应用进程叫服务器</li>
</ul>
<h3 id="连接建立-三次握手"><a class="markdownIt-Anchor" href="#连接建立-三次握手"></a> 连接建立 (三次握手)</h3>
<ol>
<li>客户端发送 <strong>连接请求报文段</strong>，无应用层数据
<ul>
<li>SYN=1, seq=x[随机]</li>
</ul>
</li>
<li>服务器为该 TCP 连接 <strong>分配缓存和变量</strong>，并向客户端返回 <strong>确认报文段</strong>，允许连接，无应用数据
<ul>
<li>SYN=1, ACK=1, seq=y[随机], ack=x+1</li>
</ul>
</li>
<li>客户端为该 TCP 连接 <strong>分配缓存和变量</strong>，并向客户端返回确认的确认，可以携带数据
<ul>
<li>SYN=0, ACK=1, seq=x+1, ack=y+1</li>
</ul>
</li>
</ol>
<p><img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200428092420.png" class="lazyload"></p>
<h4 id="syn-洪泛攻击"><a class="markdownIt-Anchor" href="#syn-洪泛攻击"></a> SYN 洪泛攻击</h4>
<p>攻击者发送 TCP SYN，SYN 是 TCP 三次握手中的 <strong>第一个数据包</strong>，而服务器返回 ACK 后，该攻击者就不对其进行再确认，那么这个 TCP 连接处于挂起状态，也就是所谓的半连接状态，占用服务器的资源。</p>
<ul>
<li>仅握手两次</li>
</ul>
<h3 id="连接释放-四次握手"><a class="markdownIt-Anchor" href="#连接释放-四次握手"></a> 连接释放 (四次握手)</h3>
<ol>
<li>客户端发送 <strong>连接释放报文段</strong>，停止发送数据，关闭 TCP 连接
<ul>
<li>FIN=1, seq=u[最后发送的数据序号+1]</li>
</ul>
</li>
<li>服务器端回送一个确认报文段，客户到服务器这个方向的连接就释放了——半关闭状态
<ul>
<li>ACK=1, seq=v, ack=u+1</li>
</ul>
</li>
<li>服务器端发完数据，就发出 <strong>连接释放报文段</strong>，主动关闭 TCP 连接
<ul>
<li>FIN=1, ACK=1, seq=w, ack=u+1</li>
</ul>
</li>
<li>客户端回送一个确认报文段，再等到时间等待计时器设置的 2MSL（最长报文段寿命）【防止确认报文段丢失】后，连接彻底关闭
<ul>
<li>ACK=1, seq=u+1, ack=w+1</li>
</ul>
</li>
</ol>
<p><img alt data-src="https://cdn.jsdelivr.net/gh/easonzzzz/BlogPic/img/20200428093101.png" class="lazyload"></p>
<h2 id="tcp-可靠传输"><a class="markdownIt-Anchor" href="#tcp-可靠传输"></a> TCP 可靠传输</h2>
<p><strong>可靠</strong>：保证接收方进程从 <strong>缓存区</strong> 读出的字节流与发送方发出的字节流完全一样的<br>
TCP 实现可靠传输的机制：</p>
<ol>
<li><strong>校验</strong>：与 UDP 校验一样，增加伪首部</li>
<li><strong>序号</strong>：一个字节占一个序号。<strong>序号字段</strong> 指的是一个报文段第一个字节的序号。</li>
<li><strong>确认</strong>：TCP 默认使用 <strong>累计确认</strong></li>
<li><strong>重传</strong>：TCP 的发送方 <em>超时重传</em>
<ul>
<li><strong>重传时间</strong>：采用自适应算法，<em><strong>动态改变重传时间 RTTs</strong></em>（加权平均往返时间）</li>
<li><strong>为什么动态改变</strong>：由于 TCP 的下层是一个互联网环境，IP 数据报所选择的路由变化很大。因而传输层的往返时间的方差也很大</li>
<li><strong>快速重传</strong>：
<ul>
<li>接收方每收到一个失序的报文段后就立即发出重复确认</li>
<li>发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段</li>
<li>快重传并非取消重传计时器，而是在某些情况下可更早地重传丢失的报文段</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="tcp-流量控制"><a class="markdownIt-Anchor" href="#tcp-流量控制"></a> TCP 流量控制</h2>
<p><strong>流量控制</strong>：让 <strong>发送方慢点</strong>，要让接收方来得及接收。</p>
<p>TCP 利用 <strong>滑动窗口</strong> 机制实现流控制。</p>
<ul>
<li>
<p>发送方维持 <strong>拥塞窗口 cwnd</strong>，根据网络的拥塞程度动态调整。</p>
</li>
<li>
<p>接收方根据自己 <strong>接收缓存的大小</strong>，<em>动态地调整</em> 发送方的发送窗口大小，即接收窗口 rwnd（接收方设置 <strong>窗口字段</strong> 来将 rwnd 通知给发送方），发送方的 <strong>发送窗口 = Min{接收窗口rwnd, 拥塞窗口cwnd}</strong></p>
</li>
<li>
<p>TCP 为每一个连接设有一个持续计时器，只要 TCP 连接的一方收到零窗口通知，就启动。到期后就发送一个零窗口的 <strong>探测报文段</strong>，得到当前窗口值，若为0则重新设置计时器。</p>
</li>
</ul>
<h2 id="tcp-拥塞控制"><a class="markdownIt-Anchor" href="#tcp-拥塞控制"></a> TCP 拥塞控制</h2>
<p>出现拥塞的条件：对资源需求的总和 &gt; 可用资源</p>
<p><strong>拥塞控制</strong>：防止过多的数据注入到网络中。<strong>全局性</strong>，涉及到所有主机、所有路由器，以及与降低网络传输性能有关的所有因素。</p>
<p><strong>流量控制</strong>：往往指在给定的发送端和接收端之间的<strong>点对点</strong>通信量的控制</p>
<ul>
<li><strong>接收窗口 (receive window, rwnd)</strong>：接收方根据其目前的接收缓存大小所许诺的最新的窗口值，是来自接收方的流量控制</li>
<li><strong>拥塞窗口 (congesition window, cwnd)</strong>：发送方根据自己估计的网络拥塞程度而设置的窗口值，是来自发送方的流量控制
<ul>
<li><strong>发送窗口 = Min{接收窗口rwnd, 拥塞窗口cwnd}</strong></li>
</ul>
</li>
</ul>
<h3 id="慢开始和拥塞避免"><a class="markdownIt-Anchor" href="#慢开始和拥塞避免"></a> 慢开始和拥塞避免</h3>
<p><img alt data-src="assets/20200508124115.png" class="lazyload"></p>
<ul>
<li><strong>一个传输轮次</strong>：把 cwnd 所允许发送的报文段都发送出去，并收到它们的确认的时间。
<ul>
<li>“传输轮次”的时间并不是固定不变的</li>
<li>图中一个传输轮次为一个往返时延 RTT</li>
</ul>
</li>
<li><strong>慢开始</strong>
<ul>
<li>“慢”是指：开始时发送速率“慢”（cwnd = 1）</li>
<li>收到一个对新报文段的确认（不包括重传），就使 cwnd 加 1，因此每次都增加一倍，即 <strong>指数增长</strong></li>
</ul>
</li>
<li><strong>拥塞避免</strong>
<ul>
<li>cwnd 每经过 <strong>一个往返时延 RTT</strong> 就 <strong>增加一个 MSS 的大小</strong>（而不管在时间 RTT 内收到了几个 ACK），<strong>线性增长</strong></li>
</ul>
</li>
<li><strong>慢启动门限 ssthresh</strong>：出现拥塞时的发送窗口值的一半</li>
</ul>
<h3 id="快重传和快恢复"><a class="markdownIt-Anchor" href="#快重传和快恢复"></a> 快重传和快恢复</h3>
<p><img alt data-src="assets/20200508125732.png" class="lazyload"></p>
<ul>
<li>刚开始仍然是慢开始、拥塞避免，但是采用了快重传、快恢复技术，拥塞时不是直接减到 1，而是减到新的 ssthresh</li>
<li><strong>慢启动门限 ssthresh</strong>：依然是出现拥塞时的发送窗口值的一半</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">EasonZzZz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/07/01/学习/计网/传输层/">http://yoursite.com/2020/07/01/学习/计网/传输层/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com">Nice To Meet U</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/计网/">计网    </a></div><div class="post_share"></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/11/学习/Web/前端/HTML基础/"><img class="prev_cover lazyload" data-src="https://source.unsplash.com/collection/collectionid/1600x900" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>HTML基础</span></div></a></div><div class="next-post pull_right"><a href="/2020/07/01/学习/计网/应用层/"><img class="next_cover lazyload" data-src="https://api.dujin.org/bing/1920.php" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>应用层</span></div></a></div></nav></div></div><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By EasonZzZz</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script async src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><script src="/js/third-party/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>